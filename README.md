# LLM Guard Agent

大模型护栏（LLM Guard Agent）是一个用于大语言模型（如 OpenAI、DeepSeek 等）API 接口的内容安全代理，支持多模态输入（文本、图片、文件），可灵活配置敏感词规则，具备现代化日志大屏和二次开发友好性。

---

## 设计理念

- **安全合规**：拦截和过滤用户输入、模型输出、文件上传等多种内容，防止敏感信息泄露或违规内容生成。
- **多模态支持**：支持文本、~~图片（OCR）~~、文档（PDF、TXT、MD、~~DOCX~~）等多种输入类型。
- **高可扩展性**：规则可通过 YAML~~/JSON/数据库~~灵活配置，易于二次开发和集成。
- **现代化运维**：内置大屏风格 Web 日志分析页面，支持日志导入、导出、删除、分页、统计等。

---

## 主要功能

- **OpenAI/DeepSeek API 兼容代理**：/v1/chat/completions 代理，支持多模态消息体。
- **文件上传检测**：/v1/upload 支持文件名和内容检测，自动转发到大模型。
- **敏感词规则系统**：支持关键词、正则表达式，规则热加载。
- **日志持久化与分析**：JSON 日志文件，支持 Web 大屏分析、导入导出、批量删除。
- **现代化前端**：ECharts+Bootstrap 大屏，支持多选、分页、趋势分析、类型分布等。

---

## 代码结构

```
llm-guard-agent/
├── cmd/                # 启动入口 main.go
├── config/             # 配置文件（config.yaml、rules.yaml）
├── internal/
│   ├── agent/          # 主要业务逻辑（代理、上传、日志、API）
│   ├── config/         # 配置加载
│   ├── multimodal/     # 多模态内容解析（OCR、文件解析）
│   ├── rules/          # 规则系统（关键词、正则、描述）
│   └── web/templates/  # 前端页面（index.html）
├── logs/               # JSON 日志文件
├── go.mod/go.sum       # Go 依赖
```

---

## 二次开发建议

1. **扩展规则系统**
- 支持更多规则类型（如 IP、用户ID、上下文等）。
- 支持规则热加载、数据库存储。
2. **多模态能力增强**
- 集成更强的 OCR、音频转文本、图片内容识别等。
- 支持更多文件格式。
3. **API 扩展**
- 增加更多管理接口（如规则管理、日志检索、批量导入导出等）。
- 支持多模型路由、负载均衡。
4. **前端大屏扩展**
- 增加多天日志分析、更多可视化图表、权限管理等。
- 支持自定义看板、告警推送。
5. **高可用与安全**
- 支持 HTTPS、认证、限流、审计等。
- 支持分布式部署。

---

## 快速启动

1. 安装依赖
```bash
go mod tidy
```
2. 配置规则和参数
- 编辑 `config/config.yaml`、`config/rules.yaml`
3. 启动服务
```bash
go run cmd/main.go
```
4. 访问 Web 日志大屏
- http://127.0.0.1:6666/index.html

---

## 典型接口说明

- **/v1/chat/completions**：OpenAI 兼容多模态代理
- **/v1/upload**：文件上传检测接口，检测通过后封装标准的openai数据结构发送至本地模型
- **/api/logs**：获取全部拦截日志（JSON）
- **/api/delete_logs**：批量删除日志

---

## 联系与贡献

如需定制开发、功能扩展或有任何建议，欢迎 issue 或 PR！
